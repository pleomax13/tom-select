{"version":3,"file":"dropdown_input.js","sources":["../../../src/constants.ts","../../../node_modules/@orchidjs/sifter/lib/diacritics.ts","../../../node_modules/@orchidjs/sifter/lib/utils.ts","../../../src/vanilla.ts","../../../src/utils.ts","../../../src/plugins/dropdown_input/plugin.ts"],"sourcesContent":["export const KEY_A\t\t\t\t= 65;\nexport const KEY_RETURN\t\t\t= 13;\nexport const KEY_ESC\t\t\t= 27;\nexport const KEY_LEFT\t\t\t= 37;\nexport const KEY_UP\t\t\t\t= 38;\nexport const KEY_RIGHT\t\t\t= 39;\nexport const KEY_DOWN\t\t\t= 40;\nexport const KEY_BACKSPACE\t\t= 8;\nexport const KEY_DELETE\t\t\t= 46;\nexport const KEY_TAB\t\t\t= 9;\n\nexport const IS_MAC      \t\t= typeof navigator === 'undefined' ? false : /Mac/.test(navigator.userAgent);\nexport const KEY_SHORTCUT\t\t= IS_MAC ? 'metaKey' : 'ctrlKey'; // ctrl key or apple key for ma\n","\n// @ts-ignore TS2691 \"An import path cannot end with a '.ts' extension\"\nimport { escape_regex } from './utils.ts';\n\ntype TDiacraticList = {[key:string]:string};\n\n// https://github.com/andrewrk/node-diacritics/blob/master/index.js\n\nvar latin_pat:RegExp;\nconst accent_pat = '[\\u0300-\\u036F\\u{b7}\\u{2be}]'; // \\u{2bc}\nconst accent_reg = new RegExp(accent_pat,'gu');\nvar diacritic_patterns:TDiacraticList;\n\nconst latin_convert:TDiacraticList = {\n\t'æ': 'ae',\n\t'ⱥ': 'a',\n\t'ø': 'o',\n};\n\nconst convert_pat = new RegExp(Object.keys(latin_convert).join('|'),'gu');\n\nconst code_points:[[number,number]] = [[ 0, 65535 ]];\n\n/**\n * Remove accents\n * via https://github.com/krisk/Fuse/issues/133#issuecomment-318692703\n *\n */\nexport const asciifold = (str:string):string => {\n\treturn str\n\t\t.normalize('NFKD')\n\t\t.replace(accent_reg, '')\n\t\t.toLowerCase()\n\t\t.replace(convert_pat,function(foreignletter) {\n\t\t\treturn latin_convert[foreignletter] || foreignletter;\n\t\t});\n};\n\n/**\n * Convert array of strings to a regular expression\n *\tex ['ab','a'] => (?:ab|a)\n * \tex ['a','b'] => [ab]\n *\n */\nexport const arrayToPattern = (chars:string[],glue:string='|'):string =>{\n\n\tif( chars.length === 1 && chars[0] != undefined ){\n\t\treturn chars[0];\n\t}\n\n\tvar longest = 1;\n\tchars.forEach((a)=>{longest = Math.max(longest,a.length)});\n\n\tif( longest == 1 ){\n\t\treturn '['+chars.join('')+']';\n\t}\n\n\treturn '(?:'+chars.join(glue)+')';\n};\n\nexport const escapeToPattern = (chars:string[]):string =>{\n\tconst escaped = chars.map((diacritic) => escape_regex(diacritic));\n\treturn arrayToPattern(escaped);\n};\n\n/**\n * Get all possible combinations of substrings that add up to the given string\n * https://stackoverflow.com/questions/30169587/find-all-the-combination-of-substrings-that-add-up-to-the-given-string\n *\n */\nexport const allSubstrings = (input:string):string[][] => {\n\n    if( input.length === 1) return [[input]];\n\n    var result:string[][] = [];\n    allSubstrings(input.substring(1)).forEach(function(subresult) {\n        var tmp = subresult.slice(0);\n        tmp[0] = input.charAt(0) + tmp[0];\n        result.push(tmp);\n\n        tmp = subresult.slice(0);\n        tmp.unshift(input.charAt(0));\n        result.push(tmp);\n    });\n\n    return result;\n}\n\n/**\n * Generate a list of diacritics from the list of code points\n *\n */\nexport const generateDiacritics = (code_points:[[number,number]]):TDiacraticList => {\n\n\tvar diacritics:{[key:string]:string[]} = {};\n\tcode_points.forEach((code_range)=>{\n\n\t\tfor(let i = code_range[0]; i <= code_range[1]; i++){\n\n\t\t\tlet diacritic\t= String.fromCharCode(i);\n\t\t\tlet\tlatin\t\t= asciifold(diacritic);\n\n\t\t\tif( latin == diacritic.toLowerCase() ){\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// skip when latin is a string longer than 3 characters long\n\t\t\t// bc the resulting regex patterns will be long\n\t\t\t// eg:\n\t\t\t// latin صلى الله عليه وسلم length 18 code point 65018\n\t\t\t// latin جل جلاله length 8 code point 65019\n\t\t\tif( latin.length > 3 ){\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst latin_diacritics:string[] = diacritics[latin] || [latin];\n\t\t\tconst patt = new RegExp( escapeToPattern(latin_diacritics),'iu');\n\t\t\tif( diacritic.match(patt) ){\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tlatin_diacritics.push(diacritic);\n\t\t\tdiacritics[latin] = latin_diacritics;\n\t\t}\n\t});\n\n\t// filter out if there's only one character in the list\n\t// todo: this may not be needed\n\tObject.keys(diacritics).forEach(latin => {\n\t\tconst latin_diacritics = diacritics[latin] || [];\n\t\tif( latin_diacritics.length < 2 ){\n\t\t\tdelete diacritics[latin];\n\t\t}\n\t});\n\n\n\t// latin character pattern\n\t// match longer substrings first\n\tlet latin_chars\t= Object.keys(diacritics).sort((a, b) => b.length - a.length );\n\tlatin_pat\t\t= new RegExp('('+ escapeToPattern(latin_chars) + accent_pat + '*)','gu');\n\n\n\t// build diacritic patterns\n\t// ae needs:\n\t//\t(?:(?:ae|Æ|Ǽ|Ǣ)|(?:A|Ⓐ|Ａ...)(?:E|ɛ|Ⓔ...))\n\tvar diacritic_patterns:TDiacraticList = {};\n\tlatin_chars.sort((a,b) => a.length -b.length).forEach((latin)=>{\n\n\t\tvar substrings\t= allSubstrings(latin);\n\t\tvar pattern = substrings.map((sub_pat)=>{\n\n\t\t\tsub_pat = sub_pat.map((l)=>{\n\t\t\t\tif( diacritics.hasOwnProperty(l) ){\n\t\t\t\t\treturn escapeToPattern(diacritics[l]!);\n\t\t\t\t}\n\t\t\t\treturn l;\n\t\t\t});\n\n\t\t\treturn arrayToPattern(sub_pat,'');\n\t\t});\n\n\t\tdiacritic_patterns[latin] = arrayToPattern(pattern);\n\t});\n\n\n\treturn diacritic_patterns;\n}\n\n/**\n * Expand a regular expression pattern to include diacritics\n * \teg /a/ becomes /aⓐａẚàáâầấẫẩãāăằắẵẳȧǡäǟảåǻǎȁȃạậặḁąⱥɐɑAⒶＡÀÁÂẦẤẪẨÃĀĂẰẮẴẲȦǠÄǞẢÅǺǍȀȂẠẬẶḀĄȺⱯ/\n *\n */\nexport const diacriticRegexPoints = (regex:string):string => {\n\n\tif( diacritic_patterns === undefined ){\n\t\tdiacritic_patterns = generateDiacritics(code_points);\n\t}\n\n\tconst decomposed\t\t= regex.normalize('NFKD').toLowerCase();\n\n\treturn decomposed.split(latin_pat).map((part:string)=>{\n\n\t\t// \"ﬄ\" or \"ffl\"\n\t\tconst no_accent = asciifold(part);\n\t\tif( no_accent == '' ){\n\t\t\treturn '';\n\t\t}\n\n\t\tif( diacritic_patterns.hasOwnProperty(no_accent) ){\n\t\t\treturn diacritic_patterns[no_accent];\n\t\t}\n\n\t\treturn part;\n\t}).join('');\n\n}\n","\n// @ts-ignore TS2691 \"An import path cannot end with a '.ts' extension\"\nimport { asciifold } from './diacritics.ts';\n\n// @ts-ignore TS2691 \"An import path cannot end with a '.ts' extension\"\nimport * as T from './types.ts';\n\n\n/**\n * A property getter resolving dot-notation\n * @param  {Object}  obj     The root object to fetch property on\n * @param  {String}  name    The optionally dotted property name to fetch\n * @return {Object}          The resolved property value\n */\nexport const getAttr = (obj:{[key:string]:any}, name:string ) => {\n    if (!obj ) return;\n    return obj[name];\n};\n\n/**\n * A property getter resolving dot-notation\n * @param  {Object}  obj     The root object to fetch property on\n * @param  {String}  name    The optionally dotted property name to fetch\n * @return {Object}          The resolved property value\n */\nexport const getAttrNesting = (obj:{[key:string]:any}, name:string ) => {\n    if (!obj ) return;\n    var part, names = name.split(\".\");\n\twhile( (part = names.shift()) && (obj = obj[part]));\n    return obj;\n};\n\n/**\n * Calculates how close of a match the\n * given value is against a search token.\n *\n */\nexport const scoreValue = (value:string, token:T.Token, weight:number ):number => {\n\tvar score, pos;\n\n\tif (!value) return 0;\n\n\tvalue = value + '';\n\tpos = value.search(token.regex);\n\tif (pos === -1) return 0;\n\n\tscore = token.string.length / value.length;\n\tif (pos === 0) score += 0.5;\n\n\treturn score * weight;\n};\n\n/**\n *\n * https://stackoverflow.com/questions/63006601/why-does-u-throw-an-invalid-escape-error\n */\nexport const escape_regex = (str:string):string => {\n\treturn (str + '').replace(/([\\$\\(\\)\\*\\+\\.\\?\\[\\]\\^\\{\\|\\}\\\\])/gu, '\\\\$1');\n};\n\n\n/**\n * Cast object property to an array if it exists and has a value\n *\n */\nexport const propToArray = (obj:{[key:string]:any}, key:string) => {\n\tvar value = obj[key];\n\n\tif( typeof value == 'function' ) return value;\n\n\tif( value && !Array.isArray(value) ){\n\t\tobj[key] = [value];\n\t}\n}\n\n\n/**\n * Iterates over arrays and hashes.\n *\n * ```\n * iterate(this.items, function(item, id) {\n *    // invoked for each item\n * });\n * ```\n *\n */\nexport const iterate = (object:[]|{[key:string]:any}, callback:(value:any,key:number|string)=>any) => {\n\n\tif ( Array.isArray(object)) {\n\t\tobject.forEach(callback);\n\n\t}else{\n\n\t\tfor (var key in object) {\n\t\t\tif (object.hasOwnProperty(key)) {\n\t\t\t\tcallback(object[key], key);\n\t\t\t}\n\t\t}\n\t}\n};\n\n\n\nexport const cmp = (a:number|string, b:number|string) => {\n\tif (typeof a === 'number' && typeof b === 'number') {\n\t\treturn a > b ? 1 : (a < b ? -1 : 0);\n\t}\n\ta = asciifold(a + '').toLowerCase();\n\tb = asciifold(b + '').toLowerCase();\n\tif (a > b) return 1;\n\tif (b > a) return -1;\n\treturn 0;\n};\n","\r\nimport { iterate } from '@orchidjs/sifter/lib/utils';\r\n\r\n/**\r\n * Return a dom element from either a dom query string, jQuery object, a dom element or html string\r\n * https://stackoverflow.com/questions/494143/creating-a-new-dom-element-from-an-html-string-using-built-in-dom-methods-or-pro/35385518#35385518\r\n *\r\n * param query should be {}\r\n */\r\nexport const getDom = ( query:any ):HTMLElement => {\r\n\r\n\tif( query.jquery ){\r\n\t\treturn query[0];\r\n\t}\r\n\r\n\tif( query instanceof HTMLElement ){\r\n\t\treturn query;\r\n\t}\r\n\r\n\tif( isHtmlString(query) ){\r\n\t\tlet div = document.createElement('div');\r\n\t\tdiv.innerHTML = query.trim(); // Never return a text node of whitespace as the result\r\n\t\treturn div.firstChild as HTMLElement;\r\n\t}\r\n\r\n\treturn document.querySelector(query);\r\n};\r\n\r\nexport const isHtmlString = (arg:any): boolean => {\r\n\tif( typeof arg === 'string' && arg.indexOf('<') > -1 ){\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nexport const escapeQuery = (query:string):string => {\r\n\treturn query.replace(/['\"\\\\]/g, '\\\\$&');\r\n}\r\n\r\n/**\r\n * Dispatch an event\r\n *\r\n */\r\nexport const triggerEvent = ( dom_el:HTMLElement, event_name:string ):void => {\r\n\tvar event = document.createEvent('HTMLEvents');\r\n\tevent.initEvent(event_name, true, false);\r\n\tdom_el.dispatchEvent(event)\r\n};\r\n\r\n/**\r\n * Apply CSS rules to a dom element\r\n *\r\n */\r\nexport const applyCSS = ( dom_el:HTMLElement, css:{ [key: string]: string|number }):void => {\r\n\tObject.assign(dom_el.style, css);\r\n}\r\n\r\n\r\n/**\r\n * Add css classes\r\n *\r\n */\r\nexport const addClasses = ( elmts:HTMLElement|HTMLElement[], ...classes:string[]|string[][] ) => {\r\n\r\n\tvar norm_classes \t= classesArray(classes);\r\n\telmts\t\t\t\t= castAsArray(elmts);\r\n\r\n\telmts.map( el => {\r\n\t\tnorm_classes.map( cls => {\r\n\t\t\tel.classList.add( cls );\r\n\t\t});\r\n\t});\r\n}\r\n\r\n/**\r\n * Remove css classes\r\n *\r\n */\r\n export const removeClasses = ( elmts:HTMLElement|HTMLElement[], ...classes:string[]|string[][] ) => {\r\n\r\n \tvar norm_classes \t= classesArray(classes);\r\n\telmts\t\t\t\t= castAsArray(elmts);\r\n\r\n\telmts.map( el => {\r\n\t\tnorm_classes.map(cls => {\r\n\t \t\tel.classList.remove( cls );\r\n\t\t});\r\n \t});\r\n }\r\n\r\n\r\n/**\r\n * Return arguments\r\n *\r\n */\r\nexport const classesArray = (args:string[]|string[][]):string[] => {\r\n\tvar classes:string[] = [];\r\n\titerate( args, (_classes) =>{\r\n\t\tif( typeof _classes === 'string' ){\r\n\t\t\t_classes = _classes.trim().split(/[\\11\\12\\14\\15\\40]/);\r\n\t\t}\r\n\t\tif( Array.isArray(_classes) ){\r\n\t\t\tclasses = classes.concat(_classes);\r\n\t\t}\r\n\t});\r\n\r\n\treturn classes.filter(Boolean);\r\n}\r\n\r\n\r\n/**\r\n * Create an array from arg if it's not already an array\r\n *\r\n */\r\nexport const castAsArray = (arg:any):Array<any> => {\r\n\tif( !Array.isArray(arg) ){\r\n \t\targ = [arg];\r\n \t}\r\n\treturn arg;\r\n}\r\n\r\n\r\n/**\r\n * Get the closest node to the evt.target matching the selector\r\n * Stops at wrapper\r\n *\r\n */\r\nexport const parentMatch = ( target:null|HTMLElement, selector:string, wrapper?:HTMLElement ):HTMLElement|void => {\r\n\r\n\tif( wrapper && !wrapper.contains(target) ){\r\n\t\treturn;\r\n\t}\r\n\r\n\twhile( target && target.matches ){\r\n\r\n\t\tif( target.matches(selector) ){\r\n\t\t\treturn target;\r\n\t\t}\r\n\r\n\t\ttarget = target.parentNode as HTMLElement;\r\n\t}\r\n}\r\n\r\n\r\n/**\r\n * Get the first or last item from an array\r\n *\r\n * > 0 - right (last)\r\n * <= 0 - left (first)\r\n *\r\n */\r\nexport const getTail = ( list:Array<any>|NodeList, direction:number=0 ):any => {\r\n\r\n\tif( direction > 0 ){\r\n\t\treturn list[list.length-1];\r\n\t}\r\n\r\n\treturn list[0];\r\n}\r\n\r\n/**\r\n * Return true if an object is empty\r\n *\r\n */\r\nexport const isEmptyObject = (obj:object):boolean => {\r\n\treturn (Object.keys(obj).length === 0);\r\n}\r\n\r\n\r\n/**\r\n * Get the index of an element amongst sibling nodes of the same type\r\n *\r\n */\r\nexport const nodeIndex = ( el:null|Element, amongst?:string ):number => {\r\n\tif (!el) return -1;\r\n\r\n\tamongst = amongst || el.nodeName;\r\n\r\n\tvar i = 0;\r\n\twhile( el = el.previousElementSibling ){\r\n\r\n\t\tif( el.matches(amongst) ){\r\n\t\t\ti++;\r\n\t\t}\r\n\t}\r\n\treturn i;\r\n}\r\n\r\n\r\n/**\r\n * Set attributes of an element\r\n *\r\n */\r\nexport const setAttr = (el:Element,attrs:{ [key: string]: null|string|number }) => {\r\n\titerate( attrs,(val,attr) => {\r\n\t\tif( val == null ){\r\n\t\t\tel.removeAttribute(attr as string);\r\n\t\t}else{\r\n\t\t\tel.setAttribute(attr as string, ''+val);\r\n\t\t}\r\n\t});\r\n}\r\n\r\n\r\n/**\r\n * Replace a node\r\n */\r\nexport const replaceNode = ( existing:Node, replacement:Node ) => {\r\n\tif( existing.parentNode ) existing.parentNode.replaceChild(replacement, existing);\r\n}\r\n","\r\nimport TomSelect from './tom-select';\r\nimport { TomLoadCallback } from './types/index';\r\n\r\n\r\n/**\r\n * Converts a scalar to its best string representation\r\n * for hash keys and HTML attribute values.\r\n *\r\n * Transformations:\r\n *   'str'     -> 'str'\r\n *   null      -> ''\r\n *   undefined -> ''\r\n *   true      -> '1'\r\n *   false     -> '0'\r\n *   0         -> '0'\r\n *   1         -> '1'\r\n *\r\n */\r\nexport const hash_key = (value:undefined|null|boolean|string):string|null => {\r\n\tif (typeof value === 'undefined' || value === null) return null;\r\n\treturn get_hash(value);\r\n};\r\n\r\nexport const get_hash = (value:boolean|string):string => {\r\n\tif (typeof value === 'boolean') return value ? '1' : '0';\r\n\treturn value + '';\r\n};\r\n\r\n/**\r\n * Escapes a string for use within HTML.\r\n *\r\n */\r\nexport const escape_html = (str:string):string => {\r\n\treturn (str + '')\r\n\t\t.replace(/&/g, '&amp;')\r\n\t\t.replace(/</g, '&lt;')\r\n\t\t.replace(/>/g, '&gt;')\r\n\t\t.replace(/\"/g, '&quot;');\r\n};\r\n\r\n\r\n/**\r\n * Debounce the user provided load function\r\n *\r\n */\r\nexport const loadDebounce = (fn:(value:string,callback:TomLoadCallback) => void,delay:number) => {\r\n\tvar timeout: null|ReturnType<typeof setTimeout>;\r\n\treturn function(this:TomSelect, value:string,callback:TomLoadCallback) {\r\n\t\tvar self = this;\r\n\r\n\t\tif( timeout ){\r\n\t\t\tself.loading = Math.max(self.loading - 1, 0);\r\n\t\t\tclearTimeout(timeout);\r\n\t\t}\r\n\t\ttimeout = setTimeout(function() {\r\n\t\t\ttimeout = null;\r\n\t\t\tself.loadedSearches[value] = true;\r\n\t\t\tfn.call(self, value, callback);\r\n\r\n\t\t}, delay);\r\n\t};\r\n};\r\n\r\n\r\n/**\r\n * Debounce all fired events types listed in `types`\r\n * while executing the provided `fn`.\r\n *\r\n */\r\nexport const debounce_events = ( self:TomSelect, types:string[], fn:() => void ) => {\r\n\tvar type:string;\r\n\tvar trigger = self.trigger;\r\n\tvar event_args:{ [key: string]: any } = {};\r\n\r\n\t// override trigger method\r\n\tself.trigger = function(){\r\n\t\tvar type = arguments[0];\r\n\t\tif (types.indexOf(type) !== -1) {\r\n\t\t\tevent_args[type] = arguments;\r\n\t\t} else {\r\n\t\t\treturn trigger.apply(self, arguments);\r\n\t\t}\r\n\t};\r\n\r\n\t// invoke provided function\r\n\tfn.apply(self, []);\r\n\tself.trigger = trigger;\r\n\r\n\t// trigger queued events\r\n\tfor( type of types ){\r\n\t\tif( type in event_args ){\r\n\t\t\ttrigger.apply(self, event_args[type]);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n\r\n/**\r\n * Determines the current selection within a text input control.\r\n * Returns an object containing:\r\n *   - start\r\n *   - length\r\n *\r\n */\r\nexport const getSelection = (input:HTMLInputElement):{ start: number; length: number } => {\r\n\treturn {\r\n\t\tstart\t: input.selectionStart || 0,\r\n\t\tlength\t: (input.selectionEnd||0) - (input.selectionStart||0),\r\n\t};\r\n};\r\n\r\n\r\n/**\r\n * Prevent default\r\n *\r\n */\r\nexport const preventDefault = (evt?:Event, stop:boolean=false):void => {\r\n\tif( evt ){\r\n\t\tevt.preventDefault();\r\n\t\tif( stop ){\r\n\t\t\tevt.stopPropagation();\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\n/**\r\n * Prevent default\r\n *\r\n */\r\nexport const addEvent = (target:EventTarget, type:string, callback:EventListenerOrEventListenerObject, options?:object):void => {\r\n\ttarget.addEventListener(type,callback,options);\r\n};\r\n\r\n\r\n/**\r\n * Return true if the requested key is down\r\n * Will return false if more than one control character is pressed ( when [ctrl+shift+a] != [ctrl+a] )\r\n * The current evt may not always set ( eg calling advanceSelection() )\r\n *\r\n */\r\nexport const isKeyDown = ( key_name:keyof (KeyboardEvent|MouseEvent), evt?:KeyboardEvent|MouseEvent ) => {\r\n\r\n\tif( !evt ){\r\n\t\treturn false;\r\n\t}\r\n\r\n\tif( !evt[key_name] ){\r\n\t\treturn false;\r\n\t}\r\n\r\n\tvar count = (evt.altKey?1:0) + (evt.ctrlKey?1:0) + (evt.shiftKey?1:0) + (evt.metaKey?1:0);\r\n\r\n\tif( count === 1 ){\r\n\t\treturn true;\r\n\t}\r\n\r\n\treturn false;\r\n};\r\n\r\n\r\n/**\r\n * Get the id of an element\r\n * If the id attribute is not set, set the attribute with the given id\r\n *\r\n */\r\nexport const getId = (el:Element,id:string) => {\r\n\tconst existing_id = el.getAttribute('id');\r\n\tif( existing_id ){\r\n\t\treturn existing_id;\r\n\t}\r\n\r\n\tel.setAttribute('id',id);\r\n\treturn id;\r\n};\r\n\r\n\r\n/**\r\n * Returns a string with backslashes added before characters that need to be escaped.\r\n */\r\nexport const addSlashes = (str:string):string => {\r\n\treturn str.replace(/[\\\\\"']/g, '\\\\$&');\r\n};\r\n\r\n/**\r\n *\r\n */\r\nexport const append = ( parent:Element|DocumentFragment, node: string|Node|null|undefined ):void =>{\r\n\tif( node ) parent.append(node);\r\n};\r\n\r\nexport const generateId = () => {\r\n\tlet result = ''\r\n\tconst characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'\r\n\tconst charactersLength = characters.length\r\n\tfor (let i = 0; i < 20; i++) {\r\n\t\tresult += characters.charAt(Math.floor(Math.random() * charactersLength))\r\n\t}\r\n\treturn result\r\n}\r\n","/**\n * Plugin: \"dropdown_input\" (Tom Select)\n * Copyright (c) contributors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this\n * file except in compliance with the License. You may obtain a copy of the License at:\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF\n * ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n *\n */\n\nimport TomSelect from '../../tom-select';\nimport * as constants from '../../constants';\nimport { getDom, addClasses, setAttr } from '../../vanilla';\nimport { addEvent, preventDefault } from '../../utils';\n\n\nexport default function(this:TomSelect) {\n\tconst self = this;\n\n\tself.settings.shouldOpen = true; // make sure the input is shown even if there are no options to display in the dropdown\n\n\tself.hook('before','setup',()=>{\n\t\tself.focus_node\t\t= self.control;\n\n\t\taddClasses( self.control_input, 'dropdown-input');\n\n\t \tconst div = getDom('<div class=\"dropdown-input-wrap\">');\n\t\tdiv.append(self.control_input);\n\t\tself.dropdown.insertBefore(div, self.dropdown.firstChild);\n\n\t\t// set a placeholder in the select control\n\t\tconst placeholder = getDom('<input class=\"items-placeholder\" tabindex=\"-1\" />') as HTMLInputElement;\n\t\tplaceholder.placeholder = self.settings.placeholder ||'';\n\t\tself.control.append(placeholder);\n\n\t});\n\n\n\tself.on('initialize',()=>{\n\n\t\t// set tabIndex on control to -1, otherwise [shift+tab] will put focus right back on control_input\n\t\tself.control_input.addEventListener('keydown',(evt:KeyboardEvent) =>{\n\t\t//addEvent(self.control_input,'keydown' as const,(evt:KeyboardEvent) =>{\n\t\t\tswitch( evt.keyCode ){\n\t\t\t\tcase constants.KEY_ESC:\n\t\t\t\t\tif (self.isOpen) {\n\t\t\t\t\t\tpreventDefault(evt,true);\n\t\t\t\t\t\tself.close();\n\t\t\t\t\t}\n\t\t\t\t\tself.clearActiveItems();\n\t\t\t\treturn;\n\t\t\t\tcase constants.KEY_TAB:\n\t\t\t\t\tself.focus_node.tabIndex = -1;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\treturn self.onKeyDown.call(self,evt);\n\t\t});\n\n\t\tself.on('blur',()=>{\n\t\t\tself.focus_node.tabIndex = self.isDisabled ? -1 : self.tabIndex;\n\t\t});\n\n\t\tself.on('option_active', () => {\n\t\t\tconst activeOption = self.control.getAttribute('aria-activedescendant')\n\n\t\t\tsetAttr(self.control_input,{'aria-activedescendant': activeOption});\n\t\t})\n\n\n\t\t// give the control_input focus when the dropdown is open\n\t\tself.on('dropdown_open',() =>{\n\t\t\tself.control_input.focus();\n\t\t});\n\n\t\t// prevent onBlur from closing when focus is on the control_input\n\t\tconst orig_onBlur = self.onBlur;\n\t\tself.hook('instead','onBlur',(evt?:FocusEvent)=>{\n\t\t\tif( evt && evt.relatedTarget == self.control_input ) return;\n\t\t\treturn orig_onBlur.call(self);\n\t\t});\n\n\t\taddEvent(self.control_input,'blur', () => self.onBlur() );\n\n\t\t// return focus to control to allow further keyboard input\n\t\tself.hook('before','close',() =>{\n\n\t\t\tif( !self.isOpen ) return;\n\t\t\tself.focus_node.focus({preventScroll: true});\n\t\t});\n\n\t});\n\n};\n"],"names":["KEY_ESC","KEY_TAB","navigator","test","userAgent","latin_convert","RegExp","Object","keys","join","iterate","object","callback","Array","isArray","forEach","key","hasOwnProperty","getDom","query","jquery","HTMLElement","isHtmlString","div","document","createElement","innerHTML","trim","firstChild","querySelector","arg","indexOf","addClasses","elmts","classes","norm_classes","classesArray","castAsArray","map","el","cls","classList","add","args","_classes","split","concat","filter","Boolean","setAttr","attrs","val","attr","removeAttribute","setAttribute","preventDefault","evt","stop","stopPropagation","addEvent","target","type","options","addEventListener","self","settings","shouldOpen","hook","focus_node","control","control_input","append","dropdown","insertBefore","placeholder","on","keyCode","constants","isOpen","close","clearActiveItems","tabIndex","onKeyDown","call","isDisabled","activeOption","getAttribute","focus","orig_onBlur","onBlur","relatedTarget","preventScroll"],"mappings":"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"}